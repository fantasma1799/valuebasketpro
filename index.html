<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ValueBasketPro</title>
  <style>
    :root {
      --bg: #050816;
      --card: #0f172a;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --accent-danger: #f97373;
      --text: #e5e7eb;
      --muted: #9ca3af;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 430px;
      background: linear-gradient(145deg, #020617cc, #020617f0);
      border-radius: 18px;
      padding: 18px 16px 22px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.35);
      backdrop-filter: blur(18px);
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .brand-badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--muted);
      text-transform: uppercase;
    }

    .brand-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
    }

    .pill {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.8);
      color: var(--muted);
    }

    .section-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
      margin: 6px 0 10px;
    }

    .card {
      background: radial-gradient(circle at top left, #020617, #020617, #000);
      border-radius: 14px;
      padding: 12px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      margin-bottom: 12px;
    }

    .row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .field {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    label {
      font-size: 11px;
      color: var(--muted);
    }

    input,
    select {
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      padding: 7px 11px;
      font-size: 13px;
      outline: none;
      width: 100%;
    }

    input:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.45);
    }

    .btn {
      border-radius: 999px;
      border: none;
      width: 100%;
      padding: 9px 12px;
      margin-top: 4px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #020617;
      box-shadow: 0 10px 22px rgba(34, 197, 94, 0.55);
      transition: transform 0.06s ease, box-shadow 0.06s ease;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 5px 12px rgba(34, 197, 94, 0.55);
    }

    .results {
      margin-top: 6px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .result-box {
      border-radius: 12px;
      padding: 8px 9px;
      background: rgba(15, 23, 42, 0.88);
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 12px;
    }

    .result-label {
      color: var(--muted);
      margin-bottom: 4px;
      font-size: 11px;
    }

    .result-value {
      font-size: 14px;
      font-weight: 700;
    }

    .result-value.green {
      color: var(--accent);
    }

    .result-value.red {
      color: var(--accent-danger);
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 9px;
      border-radius: 999px;
      background: var(--accent-soft);
      font-size: 11px;
      color: var(--accent);
      margin-top: 8px;
    }

    .tag-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
    }

    .advice {
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
    }

    .api-card {
      margin-top: 10px;
      padding: 10px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.92);
      border: 1px dashed rgba(148, 163, 184, 0.6);
      font-size: 11px;
      color: var(--muted);
    }

    .api-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .api-pill {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.15);
      color: var(--accent);
    }

    .api-log {
      margin-top: 5px;
      max-height: 100px;
      overflow: auto;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco,
        Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 10px;
      background: #020617;
      border-radius: 8px;
      padding: 8px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      color: #9ca3af;
      white-space: pre-wrap;
    }

    .api-btn {
      margin-top: 6px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
      padding: 6px 9px;
      font-size: 11px;
      width: 100%;
      text-align: center;
      cursor: pointer;
    }

    .api-btn:active {
      background: rgba(31, 41, 55, 0.95);
    }

    .footer {
      margin-top: 10px;
      font-size: 10px;
      color: var(--muted);
      text-align: center;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="brand">
        <div class="brand-title">
          <span class="brand-dot"></span>
          ValueBasketPro
        </div>
        <span class="brand-badge">NBA · Euroliga · Value Bets</span>
      </div>
      <span class="pill">v1 · Demo API gratis</span>
    </header>

    <p class="section-title">Calculadora de valor</p>
    <div class="card">
      <div class="row">
        <div class="field">
          <label for="league">Liga</label>
          <select id="league">
            <option value="NBA">NBA</option>
            <option value="EURO">Euroliga</option>
          </select>
        </div>
        <div class="field">
          <label for="stake">Stake (soles)</label>
          <input
            type="number"
            id="stake"
            placeholder="Ej: 50"
            min="1"
            step="1"
          />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="oddLocal">Cuota local</label>
          <input
            type="number"
            id="oddLocal"
            placeholder="Ej: 1.85"
            min="1"
            step="0.01"
          />
        </div>
        <div class="field">
          <label for="probLocal">% prob. local</label>
          <input
            type="number"
            id="probLocal"
            placeholder="Ej: 57"
            min="1"
            max="99"
            step="0.1"
          />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="oddVisit">Cuota visitante</label>
          <input
            type="number"
            id="oddVisit"
            placeholder="Ej: 2.10"
            min="1"
            step="0.01"
          />
        </div>
        <div class="field">
          <label for="probVisit">% prob. visitante</label>
          <input
            type="number"
            id="probVisit"
            placeholder="Ej: 43"
            min="1"
            max="99"
            step="0.1"
          />
        </div>
      </div>

      <button class="btn" id="btnCalcular">Calcular valor</button>

      <div class="results">
        <div class="result-box">
          <div class="result-label">EV Local (por sol)</div>
          <div class="result-value" id="evLocal">–</div>
        </div>
        <div class="result-box">
          <div class="result-label">EV Visitante (por sol)</div>
          <div class="result-value" id="evVisit">–</div>
        </div>
        <div class="result-box">
          <div class="result-label">Stake sugerido local</div>
          <div class="result-value" id="stakeLocal">–</div>
        </div>
        <div class="result-box">
          <div class="result-label">Stake sugerido visitante</div>
          <div class="result-value" id="stakeVisit">–</div>
        </div>
      </div>

      <div class="tag" id="tagEstado" style="display: none;">
        <span class="tag-dot"></span>
        <span id="txtEstado"></span>
      </div>

      <p class="advice" id="txtConsejo">
        Ingresa tus cuotas, tu estimación de probabilidad y stake.
        La app te dirá dónde hay valor y cuánto arriesgar.
      </p>
    </div>

    <p class="section-title">Demo de datos (API free)</p>
    <div class="api-card">
      <div class="api-header">
        <span>Ejemplo NBA (balldontlie)</span>
        <span class="api-pill">Solo demo, sin apuestas reales</span>
      </div>
      <p>
        Al tocar el botón se consulta una API gratuita de basket (balldontlie)
        o se muestran datos simulados si la API falla. Más adelante aquí
        conectaremos la API premium (odds + head to head).
      </p>
      <button class="api-btn" id="btnApiDemo">
        Probar llamada API gratuita
      </button>
      <div class="api-log" id="apiLog">
        Esperando prueba de API…
      </div>
    </div>

    <p class="footer">
      Gestiona el bankroll con disciplina. La app ayuda, pero no garantiza
      ganancias. &copy; 2025
    </p>
  </div>

  <script>
    // ----------- CALCULADORA DE VALOR -----------
    function calcularEV(cuota, prob, stake) {
      const p = prob / 100;
      const q = 1 - p;
      const evPorUnidad = p * (cuota - 1) - q; // valor por sol apostado
      const evTotal = evPorUnidad * stake;
      return { evPorUnidad, evTotal };
    }

    function kelly(cuota, prob) {
      const p = prob / 100;
      const q = 1 - p;
      const f = (cuota * p - 1) / (cuota - 1); // Kelly full
      return Math.max(0, f); // nunca negativo
    }

    function formatoMoneda(n) {
      if (isNaN(n)) return "–";
      return "S/ " + n.toFixed(2);
    }

    function formatoNumero(n) {
      if (isNaN(n)) return "–";
      return n.toFixed(3);
    }

    document.getElementById("btnCalcular").addEventListener("click", () => {
      const league = document.getElementById("league").value;
      const stake = parseFloat(document.getElementById("stake").value);
      const oddLocal = parseFloat(document.getElementById("oddLocal").value);
      const oddVisit = parseFloat(document.getElementById("oddVisit").value);
      const probLocal = parseFloat(document.getElementById("probLocal").value);
      const probVisit = parseFloat(document.getElementById("probVisit").value);

      const evLocal = calcularEV(oddLocal, probLocal, stake || 0);
      const evVisit = calcularEV(oddVisit, probVisit, stake || 0);

      const kellyLocal = kelly(oddLocal, probLocal);
      const kellyVisit = kelly(oddVisit, probVisit);

      const stakeSugLocal = (stake || 0) * kellyLocal * 0.5; // medio Kelly
      const stakeSugVisit = (stake || 0) * kellyVisit * 0.5;

      document.getElementById("evLocal").textContent = formatoNumero(
        evLocal.evPorUnidad
      );
      document.getElementById("evVisit").textContent = formatoNumero(
        evVisit.evPorUnidad
      );
      document.getElementById("stakeLocal").textContent =
        stakeSugLocal > 0 ? formatoMoneda(stakeSugLocal) : "No apostar";
      document.getElementById("stakeVisit").textContent =
        stakeSugVisit > 0 ? formatoMoneda(stakeSugVisit) : "No apostar";

      // Colores EV
      const elLocal = document.getElementById("evLocal");
      const elVisit = document.getElementById("evVisit");
      elLocal.className = "result-value " + (evLocal.evPorUnidad > 0 ? "green" : "red");
      elVisit.className = "result-value " + (evVisit.evPorUnidad > 0 ? "green" : "red");

      // Mensaje de recomendación
      const tag = document.getElementById("tagEstado");
      const txtEstado = document.getElementById("txtEstado");
      const consejo = document.getElementById("txtConsejo");

      tag.style.display = "inline-flex";

      if (evLocal.evPorUnidad <= 0 && evVisit.evPorUnidad <= 0) {
        txtEstado.textContent = "Sin valor claro. Mejor pasar este partido.";
        consejo.textContent =
          "Tus probabilidades no encuentran ventaja sobre las cuotas. En " +
          league +
          " es mejor saltar los partidos donde no hay edge.";
      } else if (evLocal.evPorUnidad > evVisit.evPorUnidad) {
        txtEstado.textContent = "Mayor valor en el equipo local.";
        consejo.textContent =
          "El modelo ve más edge en la cuota del local. Ajusta el stake según tu riesgo, usando la sugerencia como referencia.";
      } else {
        txtEstado.textContent = "Mayor valor en el equipo visitante.";
        consejo.textContent =
          "El visitante ofrece mejor valor esperado. Asegúrate de que tu estimación de probabilidad sea realista, sin fanatismo.";
      }
    });

    // ----------- DEMO API BALldontlie (free) -----------
    const apiLog = document.getElementById("apiLog");
    const btnApiDemo = document.getElementById("btnApiDemo");

    btnApiDemo.addEventListener("click", async () => {
      apiLog.textContent = "Consultando demo de API gratuita…";

      // Intentamos llamar a balldontlie (NBA free API).
      // Si falla (CORS, límite, etc.), mostramos datos simulados.
      try {
        const resp = await fetch(
          "https://api.balldontlie.io/v1/games?per_page=3&seasons[]=2023",
          {
            headers: {
              // Algunas versiones nuevas usan API key.
              // Si en el futuro consigues una, ponla aquí:
              // 'Authorization': 'Bearer TU_API_KEY'
            },
          }
        );

        if (!resp.ok) {
          throw new Error("HTTP " + resp.status);
        }

        const data = await resp.json();

        apiLog.textContent =
          "Respuesta de balldontlie (últimos partidos NBA, demo):\n\n" +
          JSON.stringify(
            data.data.map((g) => ({
              fecha: g.date,
              local: g.home_team?.abbreviation,
              visitante: g.visitor_team?.abbreviation,
              pts_local: g.home_team_score,
              pts_visit: g.visitor_team_score,
            })),
            null,
            2
          ) +
          "\n\nUsarás estructuras así para conectar stats reales con tu modelo de probabilidades.";
      } catch (err) {
        console.error(err);
        apiLog.textContent =
          "No se pudo conectar a la API en este momento.\n" +
          "Para que igual puedas trabajar, aquí tienes un ejemplo SIMULADO de datos que después vendrán de la API:\n\n" +
          JSON.stringify(
            [
              {
                liga: "NBA",
                local: "LAL",
                visitante: "DEN",
                spread: "-3.5",
                cuota_local: 1.80,
                cuota_visitante: 2.05,
              },
              {
                liga: "EUROLIGA",
                local: "RM",
                visitante: "BAR",
                spread: "-2.5",
                cuota_local: 1.90,
                cuota_visitante: 1.95,
              },
            ],
            null,
            2
          ) +
          "\n\nMás adelante se cambia este mock por la API premium (odds + H2H + stats).";
      }
    });
  </script>
</body>
</html>
